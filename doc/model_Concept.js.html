<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: model/Concept.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: model/Concept.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** Creates a new Concept instance.
*
* @param {document} xml - XML document representing the concept.
* @param {KAT.model.KAnnSpec} KAnnSpec - KAnnSpec this concept was declared in.
* @name KAT.model.Concept
* @this {KAT.model.Concept}
* @Alias KAT.model.Concept
* @class
*/
KAT.model.Concept = function(xml, KAnnSpec){
  var me = this;

  //parse the XML
  try{
    /**
    * XML document representing concept.
    *
    * @type {document}
    * @name KAT.model.Concept#xml
    */
    this.xml = jQuery(xml);
  } catch(e){
    throw new KAT.model.ParsingError("KAT.model.Concept: Invalid XML (Unable to parse XML). ", this.xml);
  }

  /**
  * KAnnSpec this concept was declared in.
  *
  * @type {KAT.model.KAnnSpec}
  * @name KAT.model.Concept#KAnnSpec
  */
  this.KAnnSpec = KAnnSpec;

  // check if we have a name
  if(typeof this.xml.attr("name") != "string"){
    throw new KAT.model.ParsingError("KAT.model.Concept: Invalid Invalid XML (Missing name attribute for &lt;concept>). ", this.xml);
  }

  // check if we have an rdftype
  if(typeof this.xml.attr("rdftype") != "string"){
    throw new KAT.model.ParsingError("KAT.model.Concept: Invalid Invalid XML (Missing rdftype attribute for &lt;concept>). ", this.xml);
  }

  /**
  * Name of this concept
  *
  * @type {string}
  * @name KAT.model.Concept#name
  */
  this.name = KAT.model.nameNormaliser(this.xml.attr("name"));

  //Check if the name is valid.
  if(!KAT.model.nameRegEx.test(this.name)){
    throw new KAT.model.ParsingError("KAT.model.Concept: Invalid XML ('"+this.getFullName()+"' is not a valid name). ", this.xml);
  }

  //Check if this concept already exists
  if(this.KAnnSpec.getConcept(this.name)){
    throw new KAT.model.ParsingError("KAT.model.Concept: Invalid XML (Concept '"+this.getFullName()+"' already exists). ", this.xml);
  }

  /**
  * RDF Type attribute for this concept.
  *
  * @type {string}
  * @name KAT.model.Concept#rdf_type
  */
  this.rdf_type = KAT.rdf.resolveWithNameSpace(this.xml.attr("rdftype"), this.KAnnSpec.xml);

  //validation
  if(this.xml.length != 1 || !this.xml.is("concept")){
    throw new KAT.model.ParsingError("KAT.model.Concept: Invalid XML for concept '"+this.getFullName()+"' (Expected exactly one &lt;concept> tag). ", this.xml);
  }

  /**
  * Documentation of this concept
  *
  * @type {string}
  * @name KAT.model.Concept#documentation
  */
  this.documentation = "";

  /**
  * Fields declared in this concept.
  *
  * @type {KAT.model.Field[]}
  * @name KAT.model.Concept#fields
  */
  this.fields = [];

  /**
  * Hex code for colour used to draw an annotation of this concept.
  *
  * @type {string}
  * @name KAT.model.Concept#displayColour
  */
  this.displayColour = "";

  /**
  * Display to generate for this element.
  *
  * @type {string}
  * @name KAT.model.Concept#display
  */
  this.display = "";

  //validate the children
  var children = this.xml.children();

  //We want to check indexing, so we need this.
  var index = 0;

  //right length
  if(children.length &lt; 2) {
    throw new KAT.model.ParsingError("KAT.model.Concept: Invalid XML for concept '"+this.getFullName()+"' (Expected at least 2 of &lt;documentation>, &lt;field>, &lt;display> and &lt;rdf:rdf>). ", children);
  }

  //documentation
  if(children.eq(index).is("documentation")){
    this.documentation = children.eq(index).text().trim();
    index++;
  }

  //do we have a field
  var hasField = false;

  //fields
  while(children.eq(index).is("field") &amp;&amp; index &lt; children.length){
    hasField = true;
    this.fields.push(new KAT.model.Field(children.eq(index), this));
    index++;
  }

  if(!hasField){
    throw new KAT.model.ParsingError("KAT.model.Concept: Invalid XML for concept '"+this.getFullName()+"' (Missing at least one declared &lt;field>). ", children);
  }

  //display
  if(children.eq(index).is("display")){
    var display = children.eq(index);

    //Set the display
    if(display.children().length != 1 || !display.children().eq(0).is("template")){
      throw new KAT.model.ParsingError("KAT.model.Concept: Invalid XML for concept '"+this.getFullName()+"' (Missing &lt;template>). ", display);
    } else {
      this.display = display.children().html().trim();
    }

    index++;
  } else {
    throw new KAT.model.ParsingError("KAT.model.Concept: Invalid XML for concept '"+this.getFullName()+"' (Missing required &lt;display>). ", children);
  }

  //rdf:RDF
  if(index &lt; children.length){
    if(children.eq(index).prop("tagName") == "rdf:RDF"){
      this.rdf = children.eq(index).html().trim();
      index++;
    } else {
      throw new KAT.model.ParsingError("KAT.model.Concept: Invalid XML for concept '"+this.getFullName()+"' (Expected &lt;rdf:rdf> in final position. ). ", children);
    }
  }

  //whats happened? We're too long!
  if(index != children.length){
    throw new KAT.model.ParsingError("KAT.model.Concept: Invalid XML for concept '"+this.getFullName()+"' (Expected at least 2 of &lt;documentation>, &lt;fields>, &lt;display> and &lt;rdf:RDF>). ", children);
  }
};

/**
* Gets default values for this concept.
*
* @function
* @instance
* @name getDefault
* @memberof KAT.model.Concept
* @return {object} - JSOn representing default for this concept.
*/
KAT.model.Concept.prototype.getDefault = function(){
  var defaultValues = {};

  $.each(this.fields, function(field){
    if(field.type == KAT.model.Field.types.text){
      //the default is simply a text
      defaultValues[field.value] = field.default;
    } else if(field.type == KAT.model.Field.types.select){
      //the default is an option
      //either the specefied one
      //or the first one.
      defaultValues[field.value] = (field.default === "")?field.validation[0]:field.default;
    } else if(field.type == KAT.model.Field.types.reference){
      //we do want a reference, but it may be an empty reference.
      //we neccessarily want this so we can avoid conflicts.
      defaultValues[field.value] = "";
    }
  });

  return defaultValues;
};

/**
* Gets the full name of this concept.
*
* @function
* @instance
* @name getFullName
* @memberof KAT.model.Concept
* @return {string} - full Name of this concept
*/
KAT.model.Concept.prototype.getFullName = function(){
  return this.KAnnSpec.getFullName()+"."+this.name;
};

/**
* Finds a field by name.
*
* @param {string} name - Name of field to search for.
*
* @function
* @instance
* @name getField
* @memberof KAT.model.Concept
* @return {KAT.model.Field|boolean} - the field searched for or false.
*/
KAT.model.Concept.prototype.getField = function(name){
  //normalise the name
  name = KAT.model.nameNormaliser(name);

  if(!KAT.model.nameRegEx.test(name)){
    return false;
  }

  //Search for the name
  for(var i=0;i&lt;this.fields.length;i++){
    if(this.fields[i].name == name){
      return this.fields[i];
    }
  }

  //return false if not found.
  return false;
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="KAT.gui.html">gui</a></li><li><a href="KAT.model.Concept.html">Concept</a></li><li><a href="KAT.model.Field.html">Field</a></li><li><a href="KAT.model.KAnnSpec.html">KAnnSpec</a></li><li><a href="KAT.model.KAnnSpecCollection.html">KAnnSpecCollection</a></li><li><a href="KAT.model.Option.html">Option</a></li><li><a href="KAT.model.ParsingError.html">ParsingError</a></li><li><a href="KAT.reviewStore.Store.html">Store</a></li><li><a href="KAT.storage.Annotation.html">Annotation</a></li><li><a href="KAT.storage.Store.html">Store</a></li></ul><h3>Namespaces</h3><ul><li><a href="KAT.html">KAT</a></li><li><a href="KAT.model.html">model</a></li><li><a href="KAT.module.html">module</a></li><li><a href="KAT.rdf.html">rdf</a></li><li><a href="KAT.reviewStore.html">reviewStore</a></li><li><a href="KAT.sidebar.html">sidebar</a></li><li><a href="KAT.storage.html">storage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0</a> on Fri Oct 30 2015 20:10:58 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
